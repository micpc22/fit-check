<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile - FITTCHECK</title>
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <style>
    /* Reset & Base */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --accent: #5b9bd5;
      --accent-dark: #7ab3e8;
      --accent-hover: #4a8bc4;
      --muted: #a0a8b5;
      --bg: #0e1621;
      --card: #1b2430;
      font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    }
    html, body {
      background: linear-gradient(135deg, var(--bg) 0%, #1a2332 100%);
      min-height: 100vh;
      color: #fff;
    }

    /* Header */
    .site-header {
      background: rgba(14, 22, 33, 0.95);
      backdrop-filter: blur(8px);
      position: sticky;
      top: 0;
      z-index: 50;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    }
    .header-inner {
      max-width: 1280px;
      margin: 0 auto;
      padding: 1rem 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .logo {
      color: #fff;
      font-size: 1.25rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
    }
    .main-nav {
      display: none;
      align-items: center;
      gap: 2rem;
    }
    .main-nav.desktop { display: flex; }
    .main-nav a, .main-nav button {
      color: #d1d5db;
      text-decoration: none;
      padding: 0.5rem 0.75rem;
      border-radius: 0.5rem;
      transition: all 0.3s;
      font-size: 0.95rem;
      font-weight: 500;
      background: none;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    .main-nav a:hover, .main-nav button:hover {
      color: var(--accent-dark);
      background: rgba(91, 155, 213, 0.15);
    }
    .nav-active {
      color: var(--accent-dark) !important;
      background: rgba(91, 155, 213, 0.15) !important;
    }
    .menu-toggle {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
    }
    .main-nav.mobile {
      display: none;
      flex-direction: column;
      background: var(--card);
      position: absolute;
      top: 100%;
      right: 1.25rem;
      width: 200px;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
      gap: 0.5rem;
    }
    .main-nav.mobile.show { display: flex; }

    /* Notifications */
    .notification-bell {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 100;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 50%;
      width: 3rem;
      height: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: all 0.3s;
    }
    .notification-bell:hover {
      background: var(--accent-dark);
      transform: scale(1.1);
    }
    .notification-badge {
      position: absolute;
      top: -0.25rem;
      right: -0.25rem;
      background: #dc2626;
      color: white;
      font-size: 0.75rem;
      border-radius: 50%;
      width: 1.25rem;
      height: 1.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .notification-panel {
      display: none;
      position: fixed;
      top: 5rem;
      right: 1rem;
      width: 20rem;
      max-height: 24rem;
      background: var(--card);
      border-radius: 0.75rem;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(91, 155, 213, 0.3);
      z-index: 99;
      overflow: hidden;
    }
    .notification-panel.active { display: block; }
    .notification-header {
      display: flex;
      justify-content: space-between;
      padding: 1rem;
      border-bottom: 1px solid rgba(91, 155, 213, 0.2);
    }
    .clear-all-btn {
      color: var(--accent);
      background: none;
      border: none;
      cursor: pointer;
      transition: color 0.2s;
    }
    .notification-list {
      max-height: 20rem;
      overflow-y: auto;
    }
    .notification-item {
      padding: 1rem;
      border-bottom: 1px solid rgba(91, 155, 213, 0.1);
    }
    .notification-empty { text-align: center; color: var(--muted); padding: 2rem; }
    .toast-container {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .toast {
      background: var(--card);
      border: 1px solid var(--accent);
      border-radius: 0.5rem;
      padding: 1rem;
      max-width: 20rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.5);
      animation: slideIn 0.3s;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* Profile Container */
    .container { max-width: 1280px; margin: 0 auto; padding: 0 1.25rem; }
    main { padding: 3rem 0; }
    .page-header {
      text-align: center;
      background: linear-gradient(135deg, #1b2430 0%, #0e1621 100%);
      padding: 3rem 0 2rem;
      border-bottom: 2px solid var(--accent);
      margin: -3rem -1.25rem 2rem;
    }
    .page-header h1 {
      color: var(--accent-dark);
      font-size: 2.5rem;
      margin-bottom: 0.75rem;
    }

    /* Profile Card */
    .profile-card {
      background: var(--card);
      padding: 2rem;
      border-radius: 0.75rem;
      border: 1px solid rgba(255,255,255,0.05);
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      max-width: 600px;
      margin: 0 auto;
    }
    .profile-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    .profile-avatar {
      width: 10rem;
      height: 10rem;
      background: rgba(91,155,213,0.1);
      border-radius: 50%;
      margin: 0 auto 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 3px solid var(--accent);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    .profile-avatar i {
      font-size: 3rem;
      color: var(--accent);
    }
    .profile-header h2 {
      color: var(--accent-dark);
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }
    .profile-header p {
      color: var(--muted);
    }
    .upload-icon {
      position: absolute;
      bottom: 0;
      right: 0;
      background: var(--accent);
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    /* Profile Info */
    .profile-info {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    .info-group {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .info-icon {
      background: rgba(91,155,213,0.1);
      padding: 0.75rem;
      border-radius: 0.5rem;
      font-size: 1.5rem;
    }
    .info-content {
      flex: 1;
    }
    .info-label {
      color: var(--muted);
      font-size: 0.875rem;
      margin-bottom: 0.25rem;
    }
    .info-value {
      color: #fff;
      font-size: 1rem;
    }

    /* Form Styles */
    .form-group { margin-bottom: 1.5rem; }
    label {
      display: block;
      margin-bottom: 0.5rem;
      color: #d1d5db;
      font-weight: 500;
    }
    input, select {
      width: 100%;
      padding: 0.625rem;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 0.5rem;
      color: white;
    }
    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
    }
    button {
      padding: 0.625rem 1.5rem;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }
    button:hover { background: var(--accent-hover); }
    button.btn-outline {
      background: transparent;
      border: 1px solid var(--accent);
      color: var(--accent);
    }
    button.btn-outline:hover {
      background: var(--accent);
      color: white;
    }
    button.btn-full { width: 100%; }

    /* Footer */
    .site-footer {
      background: rgba(0,0,0,0.5);
      color: #9ca3af;
      margin-top: 3rem;
      border-top: 1px solid rgba(255,255,255,0.05);
      padding: 1.5rem 0;
    }
    .footer-inner { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 1rem; }
    .footer-nav { display: flex; gap: 1.5rem; }
    .footer-nav a {
      color: #9ca3af;
      text-decoration: none;
      font-size: 0.875rem;
    }
    .footer-nav a:hover { color: var(--accent-dark); }

    /* Responsive */
    @media (min-width: 768px) {
      .menu-toggle { display: none; }
      .main-nav.desktop { display: flex; }
    }
    @media (max-width: 767px) {
      .menu-toggle { display: block; }
      .main-nav.desktop { display: none; }
    }
  </style>
</head>
<body>
  <!-- Notifications -->
  <button class="notification-bell" id="notificationBell">
    <i class='bx bxs-bell'></i>
    <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
  </button>
  <div class="notification-panel" id="notificationPanel">
    <div class="notification-header">
      <h3>Notifications</h3>
      <button class="clear-all-btn" id="clearAllBtn">Clear All</button>
    </div>
    <div class="notification-list" id="notificationList">
      <div class="notification-empty">No new notifications</div>
    </div>
  </div>
  <div class="toast-container" id="toastContainer"></div>

  <!-- Header -->
  <header class="site-header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <i class='bx bxs-dumbbell'></i> FITTCHECK
      </a>
      <nav class="main-nav desktop">
        <a href="index.html" id="nav-home"><i class='bx bx-home'></i> Home</a>
        <a href="classes.html" id="nav-classes"><i class='bx bx-dumbbell'></i> Classes</a>
        <a href="trainers.html" id="nav-trainers"><i class='bx bx-user-check'></i> Trainers</a>
        <a href="contact.html" id="nav-about"><i class='bx bx-info-circle'></i> About Us</a>
        <a href="tracker.html" id="nav-tracker"><i class='bx bx-trending-up'></i> Tracker</a>
        <button onclick="window.location.href='profile.html'" id="nav-profile" class="nav-active"><i class='bx bx-user'></i> Profile</button>
      </nav>
      <button class="menu-toggle" id="menuToggle">â˜°</button>
      <nav class="main-nav mobile" id="mobileNav">
        <a href="index.html" id="nav-home-mobile"><i class='bx bx-home'></i> Home</a>
        <a href="classes.html" id="nav-classes-mobile"><i class='bx bx-dumbbell'></i> Classes</a>
        <a href="trainers.html" id="nav-trainers-mobile"><i class='bx bx-user-check'></i> Trainers</a>
        <a href="contact.html" id="nav-about-mobile"><i class='bx bx-info-circle'></i> About Us</a>
        <a href="tracker.html" id="nav-tracker-mobile"><i class='bx bx-trending-up'></i> Tracker</a>
        <button onclick="window.location.href='profile.html'" id="nav-profile-mobile" class="nav-active"><i class='bx bx-user'></i> Profile</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="page-header">
      <h1>Profile Settings</h1>
      <p>Manage your personal information and account preferences</p>
    </div>

    <div class="profile-card">
      <div class="profile-header">
        <div class="profile-avatar" id="avatarContainer">
          <i class='bx bx-user' id="avatarIcon"></i>
          <div class="upload-icon">
            <i class='bx bx-camera'></i>
          </div>
          <input type="file" id="avatarInput" accept="image/*" style="display: none;">
        </div>
        <h2 id="profileName">Loading...</h2>
        <p>Member Profile</p>
      </div>

      <!-- Edit Profile Form -->
      <form id="profileForm">
        <div class="form-group">
          <label for="fullName">Full Name</label>
          <input type="text" id="fullName" required>
        </div>
        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" required>
        </div>
        <div class="form-group">
          <label for="phone">Phone Number</label>
          <input type="tel" id="phone">
        </div>
        <button type="submit" class="btn-full">Update Profile</button>
      </form>

      <!-- Change Password Form -->
      <div class="form-group" style="margin-top: 2rem;">
        <h3 style="color: var(--accent-dark); margin-bottom: 1rem;">Change Password</h3>
        <form id="passwordForm">
          <div class="form-group">
            <label for="newPassword">New Password</label>
            <input type="password" id="newPassword" placeholder="Enter new password" required>
          </div>
          <div class="form-group">
            <label for="confirmNewPassword">Confirm New Password</label>
            <input type="password" id="confirmNewPassword" placeholder="Confirm new password" required>
          </div>
          <button type="submit" class="btn-full">Update Password</button>
        </form>
        <div id="passwordMessage" style="margin-top: 1rem; text-align: center;"></div>
      </div>

      <!-- Logout Button -->
      <div style="margin-top: 2rem; text-align: center;">
        <button class="btn-outline" id="logoutBtn" style="width: auto; padding: 0.75rem 2rem;">
          <i class='bx bx-log-out'></i> Logout
        </button>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <h3><i class='bx bxs-dumbbell'></i> FITTCHECK</h3>
      <nav class="footer-nav">
        <a href="index.html">Home</a>
        <a href="classes.html">Classes</a>
        <a href="tracker.html">Tracker</a>
      </nav>
      <address><a href="mailto:hello@fittcheck.ph">hello@fittcheck.ph</a></address>
    </div>
    <div class="footer-bottom container">
      <small>Â© <span id="year"></span> FITTCHECK. All rights reserved.</small>
    </div>
  </footer>

  <script>
    // ========== STATE ==========
    let notifications = [];

    // ========== NAV ACTIVE ==========
    function setActiveNavLink() {
      const currentPage = window.location.pathname.split('/').pop() || 'index.html';
      const links = [
        { id: 'nav-home', page: 'index.html' },
        { id: 'nav-classes', page: 'classes.html' },
        { id: 'nav-trainers', page: 'trainers.html' },
        { id: 'nav-about', page: 'contact.html' },
        { id: 'nav-tracker', page: 'tracker.html' },
        { id: 'nav-profile', page: 'profile.html' }
      ];
      links.forEach(link => {
        const el = document.getElementById(link.id);
        if (currentPage === link.page) el?.classList.add('nav-active');
        else el?.classList.remove('nav-active');
      });
    }

    // ========== NOTIFICATIONS ==========
    function initializeNotifications() {
      checkMissedExercises();
      const bell = document.getElementById('notificationBell');
      const panel = document.getElementById('notificationPanel');
      bell.addEventListener('click', e => {
        e.stopPropagation(); panel.classList.toggle('active');
      });
      document.addEventListener('click', e => {
        if (!panel.contains(e.target) && e.target !== bell) panel.classList.remove('active');
      });
      document.getElementById('clearAllBtn').addEventListener('click', () => {
        notifications = []; updateNotificationUI();
      });
    }
    function checkMissedExercises() {
      const last = localStorage.getItem('lastExerciseDate');
      if (!last) return;
      const diff = Math.floor((Date.now() - new Date(last)) / (864e5));
      if (diff >= 1) {
        addNotification(`You havenâ€™t exercised in ${diff} day${diff > 1 ? 's' : ''}! ðŸ’ª`, 'missed');
      }
    }
    function addNotification(msg, type) {
      if (notifications.some(n => n.msg === msg)) return;
      notifications.unshift({ id: Date.now(), msg, type, ts: new Date() });
      updateNotificationUI();
      showToast(msg);
    }
    function updateNotificationUI() {
      const badge = document.getElementById('notificationBadge');
      const list = document.getElementById('notificationList');
      if (notifications.length) {
        badge.textContent = notifications.length;
        badge.style.display = 'flex';
        list.innerHTML = notifications.map(n =>
          `<div class="notification-item"><p>${n.msg}</p><small>${n.ts.toLocaleTimeString()}</small></div>`
        ).join('');
      } else {
        badge.style.display = 'none';
        list.innerHTML = '<div class="notification-empty">No new notifications</div>';
      }
    }
    function showToast(msg) {
      const c = document.getElementById('toastContainer');
      const t = document.createElement('div');
      t.className = 'toast';
      t.innerHTML = `<p>ðŸ”” ${msg}</p>`;
      c.appendChild(t);
      setTimeout(() => t.remove(), 5000);
    }

    // ========== MOBILE MENU ==========
    document.getElementById('menuToggle').addEventListener('click', function() {
      const nav = document.getElementById('mobileNav');
      nav.classList.toggle('show');
      this.textContent = nav.classList.contains('show') ? 'âœ•' : 'â˜°';
    });
    document.addEventListener('click', e => {
      if (!e.target.closest('.header-inner')) {
        const nav = document.getElementById('mobileNav');
        nav.classList.remove('show');
        document.getElementById('menuToggle').textContent = 'â˜°';
      }
    });

    // ========== PROFILE LOADING ==========
    function loadUserProfile() {
      const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
      if (!isLoggedIn) {
        window.location.href = 'login.html';
        return;
      }

      const currentUserEmail = localStorage.getItem('currentUserEmail');
      const userRole = localStorage.getItem('userRole');

      if (userRole === 'admin') {
        document.getElementById('profileName').textContent = 'Administrator';
        document.getElementById('fullName').value = 'Admin User';
        document.getElementById('email').value = 'admin@fittcheck.ph';
        document.getElementById('phone').value = '';
        return;
      }

      const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
      const currentUser = registeredUsers.find(user => 
        user.email.toLowerCase() === currentUserEmail.toLowerCase() || 
        user.phone === currentUserEmail
      );

      if (currentUser) {
        document.getElementById('profileName').textContent = currentUser.fullname;
        document.getElementById('fullName').value = currentUser.fullname;
        document.getElementById('email').value = currentUser.email || '';
        document.getElementById('phone').value = currentUser.phone || '';
      }
    }

    // ========== PROFILE UPDATE ==========
    document.getElementById('profileForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const fullName = document.getElementById('fullName').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;

      const currentUserEmail = localStorage.getItem('currentUserEmail');
      const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
      const userIndex = registeredUsers.findIndex(user => 
        user.email.toLowerCase() === currentUserEmail.toLowerCase() || 
        user.phone === currentUserEmail
      );

      if (userIndex !== -1) {
        registeredUsers[userIndex].fullname = fullName;
        registeredUsers[userIndex].email = email;
        registeredUsers[userIndex].phone = phone;
        localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
        
        document.getElementById('profileName').textContent = fullName;
        addNotification('Profile updated successfully! ðŸ‘¤', 'success');
      }
    });

    // ========== AVATAR UPLOAD ==========
    document.getElementById('avatarContainer').addEventListener('click', function() {
      document.getElementById('avatarInput').click();
    });

    document.getElementById('avatarInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          const avatarIcon = document.getElementById('avatarIcon');
          avatarIcon.className = 'bx'; // Clear previous class
          avatarIcon.style.backgroundImage = `url(${event.target.result})`;
          avatarIcon.style.backgroundSize = 'cover';
          avatarIcon.style.backgroundPosition = 'center';
          avatarIcon.style.borderRadius = '50%';
          avatarIcon.style.width = '100%';
          avatarIcon.style.height = '100%';
          avatarIcon.style.objectFit = 'cover';
        };
        reader.readAsDataURL(file);
      }
    });

    // ========== PASSWORD CHANGE ==========
    document.getElementById('passwordForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const newPassword = document.getElementById('newPassword').value;
      const confirmNewPassword = document.getElementById('confirmNewPassword').value;
      const messageEl = document.getElementById('passwordMessage');

      if (newPassword.length < 6) {
        messageEl.textContent = 'Password must be at least 6 characters';
        messageEl.style.color = '#ef4444';
        return;
      }

      if (newPassword !== confirmNewPassword) {
        messageEl.textContent = 'Passwords do not match';
        messageEl.style.color = '#ef4444';
        return;
      }

      const currentUserEmail = localStorage.getItem('currentUserEmail');
      const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
      const userIndex = registeredUsers.findIndex(user => 
        user.email.toLowerCase() === currentUserEmail.toLowerCase() || 
        user.phone === currentUserEmail
      );

      if (userIndex !== -1) {
        registeredUsers[userIndex].password = newPassword;
        localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
        
        messageEl.textContent = 'Password updated successfully!';
        messageEl.style.color = '#4ade80';
        document.getElementById('passwordForm').reset();
        
        addNotification('Password updated successfully! ðŸ—ï¸', 'success');
      }
    });

    // ========== LOGOUT ==========
    document.getElementById('logoutBtn').addEventListener('click', function() {
      localStorage.removeItem('isLoggedIn');
      localStorage.removeItem('userRole');
      localStorage.removeItem('currentUserEmail');
      window.location.href = 'login.html';
    });

    // ========== INIT ==========
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('year').textContent = new Date().getFullYear();
      loadUserProfile();
      initializeNotifications();
      setActiveNavLink();
    });
  </script>
</body>
</html>